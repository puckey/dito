"use strict";

exports.__esModule = true;
exports.handleError = handleError;

var _errors = require("../errors");

function handleError() {
  return async (ctx, next) => {
    try {
      await next();
    } catch (err) {
      ctx.body = undefined;
      ctx.status = err.status || 500;

      if (ctx.accepts('json') && !ctx.request.path.endsWith('.js')) {
        ctx.body = err instanceof _errors.ResponseError ? err.toJSON() : {
          message: err.message || 'An error has occurred.'
        };
      } else {}

      ctx.app.emit('error', err, ctx);
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2hhbmRsZUVycm9yLmpzIl0sIm5hbWVzIjpbImhhbmRsZUVycm9yIiwiY3R4IiwibmV4dCIsImVyciIsImJvZHkiLCJ1bmRlZmluZWQiLCJzdGF0dXMiLCJhY2NlcHRzIiwicmVxdWVzdCIsInBhdGgiLCJlbmRzV2l0aCIsIlJlc3BvbnNlRXJyb3IiLCJ0b0pTT04iLCJtZXNzYWdlIiwiYXBwIiwiZW1pdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7QUFFTyxTQUFTQSxXQUFULEdBQXVCO0FBQzVCLFNBQU8sT0FBT0MsR0FBUCxFQUFZQyxJQUFaLEtBQXFCO0FBQzFCLFFBQUk7QUFDRixZQUFNQSxJQUFJLEVBQVY7QUFDRCxLQUZELENBRUUsT0FBT0MsR0FBUCxFQUFZO0FBQ1pGLE1BQUFBLEdBQUcsQ0FBQ0csSUFBSixHQUFXQyxTQUFYO0FBQ0FKLE1BQUFBLEdBQUcsQ0FBQ0ssTUFBSixHQUFhSCxHQUFHLENBQUNHLE1BQUosSUFBYyxHQUEzQjs7QUFHQSxVQUFJTCxHQUFHLENBQUNNLE9BQUosQ0FBWSxNQUFaLEtBQXVCLENBQUNOLEdBQUcsQ0FBQ08sT0FBSixDQUFZQyxJQUFaLENBQWlCQyxRQUFqQixDQUEwQixLQUExQixDQUE1QixFQUE4RDtBQUU1RFQsUUFBQUEsR0FBRyxDQUFDRyxJQUFKLEdBQVdELEdBQUcsWUFBWVEscUJBQWYsR0FDUFIsR0FBRyxDQUFDUyxNQUFKLEVBRE8sR0FFUDtBQUNBQyxVQUFBQSxPQUFPLEVBQUVWLEdBQUcsQ0FBQ1UsT0FBSixJQUFlO0FBRHhCLFNBRko7QUFLRCxPQVBELE1BT08sQ0FLTjs7QUFDRFosTUFBQUEsR0FBRyxDQUFDYSxHQUFKLENBQVFDLElBQVIsQ0FBYSxPQUFiLEVBQXNCWixHQUF0QixFQUEyQkYsR0FBM0I7QUFDRDtBQUNGLEdBdkJEO0FBd0JEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzcG9uc2VFcnJvciB9IGZyb20gJ0AvZXJyb3JzJ1xuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlRXJyb3IoKSB7XG4gIHJldHVybiBhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG5leHQoKVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY3R4LmJvZHkgPSB1bmRlZmluZWRcbiAgICAgIGN0eC5zdGF0dXMgPSBlcnIuc3RhdHVzIHx8IDUwMFxuICAgICAgLy8gSWYgdGhlIGJyb3dzZXIgYWNjZXB0cyBqc29uLCByZXR1cm4gYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZVxuICAgICAgLy8gZXJyb3IuIEJ1dCBkb24ndCBkbyBzbyBpZiB0aGUgcmVxdWVzdCBhY3R1YWxseSB3ZW50IHRvIGpzIGZpbGUuXG4gICAgICBpZiAoY3R4LmFjY2VwdHMoJ2pzb24nKSAmJiAhY3R4LnJlcXVlc3QucGF0aC5lbmRzV2l0aCgnLmpzJykpIHtcbiAgICAgICAgLy8gRm9ybWF0IGVycm9yIGFzIEpTT05cbiAgICAgICAgY3R4LmJvZHkgPSBlcnIgaW5zdGFuY2VvZiBSZXNwb25zZUVycm9yXG4gICAgICAgICAgPyBlcnIudG9KU09OKClcbiAgICAgICAgICA6IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlIHx8ICdBbiBlcnJvciBoYXMgb2NjdXJyZWQuJ1xuICAgICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRPRE86IENvbnNpZGVyIGhhbmRsaW5nIGh0bWwgYW5kIHhtbCByZXNwb25zZXMgYWxzbywgc2VlOlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vc3Ryb25nbG9vcC9zdHJvbmctZXJyb3ItaGFuZGxlci9ibG9iL21hc3Rlci9saWIvc2VuZC1odG1sLmpzXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9zdHJvbmdsb29wL3N0cm9uZy1lcnJvci1oYW5kbGVyL2Jsb2IvbWFzdGVyL2xpYi9zZW5kLXhtbC5qc1xuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vc3Ryb25nbG9vcC9zdHJvbmctZXJyb3ItaGFuZGxlci9ibG9iL21hc3Rlci92aWV3cy9kZWZhdWx0LWVycm9yLmVqc1xuICAgICAgfVxuICAgICAgY3R4LmFwcC5lbWl0KCdlcnJvcicsIGVyciwgY3R4KVxuICAgIH1cbiAgfVxufVxuIl19