"use strict";

exports.__esModule = true;
exports.handleRoute = handleRoute;

function handleRoute() {
  return async (ctx, next) => {
    const {
      handler
    } = ctx.route;

    if (handler) {
      await handler(ctx, next);
    } else {
      try {
        await next();
      } finally {
        if (ctx.body === undefined && ctx.status === 404) {
          ctx.status = ctx.route.status || 404;

          if (ctx.status !== 404 && ctx.route.allowed) {
            ctx.set('Allow', ctx.route.allowed.join(', '));
          }
        }
      }
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2hhbmRsZVJvdXRlLmpzIl0sIm5hbWVzIjpbImhhbmRsZVJvdXRlIiwiY3R4IiwibmV4dCIsImhhbmRsZXIiLCJyb3V0ZSIsImJvZHkiLCJ1bmRlZmluZWQiLCJzdGF0dXMiLCJhbGxvd2VkIiwic2V0Iiwiam9pbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBTyxTQUFTQSxXQUFULEdBQXVCO0FBQzVCLFNBQU8sT0FBT0MsR0FBUCxFQUFZQyxJQUFaLEtBQXFCO0FBQzFCLFVBQU07QUFBRUMsTUFBQUE7QUFBRixRQUFjRixHQUFHLENBQUNHLEtBQXhCOztBQUNBLFFBQUlELE9BQUosRUFBYTtBQUNYLFlBQU1BLE9BQU8sQ0FBQ0YsR0FBRCxFQUFNQyxJQUFOLENBQWI7QUFDRCxLQUZELE1BRU87QUFHTCxVQUFJO0FBQ0YsY0FBTUEsSUFBSSxFQUFWO0FBQ0QsT0FGRCxTQUVVO0FBQ1IsWUFBSUQsR0FBRyxDQUFDSSxJQUFKLEtBQWFDLFNBQWIsSUFBMEJMLEdBQUcsQ0FBQ00sTUFBSixLQUFlLEdBQTdDLEVBQWtEO0FBQ2hETixVQUFBQSxHQUFHLENBQUNNLE1BQUosR0FBYU4sR0FBRyxDQUFDRyxLQUFKLENBQVVHLE1BQVYsSUFBb0IsR0FBakM7O0FBR0EsY0FBSU4sR0FBRyxDQUFDTSxNQUFKLEtBQWUsR0FBZixJQUFzQk4sR0FBRyxDQUFDRyxLQUFKLENBQVVJLE9BQXBDLEVBQTZDO0FBQzNDUCxZQUFBQSxHQUFHLENBQUNRLEdBQUosQ0FBUSxPQUFSLEVBQWlCUixHQUFHLENBQUNHLEtBQUosQ0FBVUksT0FBVixDQUFrQkUsSUFBbEIsQ0FBdUIsSUFBdkIsQ0FBakI7QUFDRDtBQUNGO0FBQ0Y7QUFDRjtBQUNGLEdBcEJEO0FBcUJEIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVJvdXRlKCkge1xuICByZXR1cm4gYXN5bmMgKGN0eCwgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHsgaGFuZGxlciB9ID0gY3R4LnJvdXRlXG4gICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgIGF3YWl0IGhhbmRsZXIoY3R4LCBuZXh0KVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBObyByb3V0ZSB3YXMgZm91bmQuIFNlZSBpZiB0aGUgcmVtYWluaW5nIG1pZGRsZXdhcmUgZG9lcyBzb21ldGhpbmcgd2l0aFxuICAgICAgLy8gdGhpcyByZXF1ZXN0LiBJZiBub3QsIHJldHVybiB0aGUgZXJyb3JzIGFzIHJlY2VpdmVkIGZyb20gdGhlIHJvdXRlcjpcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IG5leHQoKVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKGN0eC5ib2R5ID09PSB1bmRlZmluZWQgJiYgY3R4LnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgY3R4LnN0YXR1cyA9IGN0eC5yb3V0ZS5zdGF0dXMgfHwgNDA0XG4gICAgICAgICAgLy8gT25seSByZXRyaWV2ZSBgYWxsb3dlZGAgbm93LCBiZWNhdXNlIGl0IGludm9sdmVzIGNhbGxpbmcgYSBnZXR0ZXJcbiAgICAgICAgICAvLyBhbmQgc29tZSBpbnRlcm5hbCBwcm9jZXNzaW5nOlxuICAgICAgICAgIGlmIChjdHguc3RhdHVzICE9PSA0MDQgJiYgY3R4LnJvdXRlLmFsbG93ZWQpIHtcbiAgICAgICAgICAgIGN0eC5zZXQoJ0FsbG93JywgY3R4LnJvdXRlLmFsbG93ZWQuam9pbignLCAnKSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==