"use strict";

exports.__esModule = true;
exports.handleUser = handleUser;

function handleUser() {
  return (ctx, next) => {
    var _ctx$logger;

    ctx.logger = ((_ctx$logger = ctx.logger) == null ? void 0 : _ctx$logger.child({
      user: ctx.state.user
    })) || null;
    const {
      login,
      logout
    } = ctx;

    ctx.login = async function (user, options = {}) {
      await user.$emit('before:login', options);
      await login.call(this, user, options);
      await user.$emit('after:login', options);
    };

    ctx.logout = async function (options = {}) {
      const {
        user
      } = ctx.state;
      await (user == null ? void 0 : user.$emit('before:logout', options));
      await logout.call(this);
      await (user == null ? void 0 : user.$emit('after:logout', options));
    };

    return next();
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2hhbmRsZVVzZXIuanMiXSwibmFtZXMiOlsiaGFuZGxlVXNlciIsImN0eCIsIm5leHQiLCJsb2dnZXIiLCJjaGlsZCIsInVzZXIiLCJzdGF0ZSIsImxvZ2luIiwibG9nb3V0Iiwib3B0aW9ucyIsIiRlbWl0IiwiY2FsbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBTyxTQUFTQSxVQUFULEdBQXNCO0FBQzNCLFNBQU8sQ0FBQ0MsR0FBRCxFQUFNQyxJQUFOLEtBQWU7QUFBQTs7QUFFcEJELElBQUFBLEdBQUcsQ0FBQ0UsTUFBSixHQUFhLGdCQUFBRixHQUFHLENBQUNFLE1BQUosaUNBQVlDLEtBQVosQ0FBa0I7QUFBRUMsTUFBQUEsSUFBSSxFQUFFSixHQUFHLENBQUNLLEtBQUosQ0FBVUQ7QUFBbEIsS0FBbEIsTUFBK0MsSUFBNUQ7QUFJQSxVQUFNO0FBQUVFLE1BQUFBLEtBQUY7QUFBU0MsTUFBQUE7QUFBVCxRQUFvQlAsR0FBMUI7O0FBRUFBLElBQUFBLEdBQUcsQ0FBQ00sS0FBSixHQUFZLGdCQUFlRixJQUFmLEVBQXFCSSxPQUFPLEdBQUcsRUFBL0IsRUFBbUM7QUFDN0MsWUFBTUosSUFBSSxDQUFDSyxLQUFMLENBQVcsY0FBWCxFQUEyQkQsT0FBM0IsQ0FBTjtBQUNBLFlBQU1GLEtBQUssQ0FBQ0ksSUFBTixDQUFXLElBQVgsRUFBaUJOLElBQWpCLEVBQXVCSSxPQUF2QixDQUFOO0FBQ0EsWUFBTUosSUFBSSxDQUFDSyxLQUFMLENBQVcsYUFBWCxFQUEwQkQsT0FBMUIsQ0FBTjtBQUNELEtBSkQ7O0FBTUFSLElBQUFBLEdBQUcsQ0FBQ08sTUFBSixHQUFhLGdCQUFlQyxPQUFPLEdBQUcsRUFBekIsRUFBNkI7QUFDeEMsWUFBTTtBQUFFSixRQUFBQTtBQUFGLFVBQVdKLEdBQUcsQ0FBQ0ssS0FBckI7QUFDQSxhQUFNRCxJQUFOLG9CQUFNQSxJQUFJLENBQUVLLEtBQU4sQ0FBWSxlQUFaLEVBQTZCRCxPQUE3QixDQUFOO0FBQ0EsWUFBTUQsTUFBTSxDQUFDRyxJQUFQLENBQVksSUFBWixDQUFOO0FBQ0EsYUFBTU4sSUFBTixvQkFBTUEsSUFBSSxDQUFFSyxLQUFOLENBQVksY0FBWixFQUE0QkQsT0FBNUIsQ0FBTjtBQUNELEtBTEQ7O0FBT0EsV0FBT1AsSUFBSSxFQUFYO0FBR0QsR0F4QkQ7QUF5QkQiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gaGFuZGxlVXNlcigpIHtcbiAgcmV0dXJuIChjdHgsIG5leHQpID0+IHtcbiAgICAvLyBBdHRhY2ggYSBsb2dnZXIgaW5zdGFuY2Ugd2l0aCB0aGUgdXNlciB0byB0aGUgY29udGV4dC5cbiAgICBjdHgubG9nZ2VyID0gY3R4LmxvZ2dlcj8uY2hpbGQoeyB1c2VyOiBjdHguc3RhdGUudXNlciB9KSB8fCBudWxsXG5cbiAgICAvLyBPdmVycmlkZSBgY3R4LmxvZ2luKClgIGFuZCBgY3R4LmxvZ291dCgpYCB3aXRoIHZlcnNpb25zIHRoYXQgZW1pdCBldmVudHNcbiAgICAvLyBvbiB0aGUgdXNlciBtb2RlbDpcbiAgICBjb25zdCB7IGxvZ2luLCBsb2dvdXQgfSA9IGN0eFxuXG4gICAgY3R4LmxvZ2luID0gYXN5bmMgZnVuY3Rpb24odXNlciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICBhd2FpdCB1c2VyLiRlbWl0KCdiZWZvcmU6bG9naW4nLCBvcHRpb25zKVxuICAgICAgYXdhaXQgbG9naW4uY2FsbCh0aGlzLCB1c2VyLCBvcHRpb25zKVxuICAgICAgYXdhaXQgdXNlci4kZW1pdCgnYWZ0ZXI6bG9naW4nLCBvcHRpb25zKVxuICAgIH1cblxuICAgIGN0eC5sb2dvdXQgPSBhc3luYyBmdW5jdGlvbihvcHRpb25zID0ge30pIHtcbiAgICAgIGNvbnN0IHsgdXNlciB9ID0gY3R4LnN0YXRlXG4gICAgICBhd2FpdCB1c2VyPy4kZW1pdCgnYmVmb3JlOmxvZ291dCcsIG9wdGlvbnMpXG4gICAgICBhd2FpdCBsb2dvdXQuY2FsbCh0aGlzKSAvLyBObyBvcHRpb25zIGluIHBhc3Nwb3J0J3MgbG9nb3V0KClcbiAgICAgIGF3YWl0IHVzZXI/LiRlbWl0KCdhZnRlcjpsb2dvdXQnLCBvcHRpb25zKVxuICAgIH1cblxuICAgIHJldHVybiBuZXh0KClcbiAgICAvLyBEb24ndCBzZXQgYmFjayBgY3R4LmxvZ2dlcmAgYmVjYXVzZSB0aGUgY29udGV4dCBpcyBzdGlsbCB2YWxpZC4gSXQgaXNcbiAgICAvLyB1c2VkIGluIGBsb2dSZXNwb25zZSgpYCBvZiB0aGUgYGxvZ1JlcXVlc3RzKClgIG1pZGRsZXdhcmUsIGFtb25nIG90aGVycy5cbiAgfVxufVxuIl19