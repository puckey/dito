"use strict";

exports.__esModule = true;
exports.AssetMixin = void 0;

var _utils = require("@ditojs/utils");

var _TimeStampedMixin = require("./TimeStampedMixin");

const AssetMixin = (0, _utils.mixin)(Model => {
  var _class, _temp;

  return _temp = _class = class extends (0, _TimeStampedMixin.TimeStampedMixin)(Model) {
    $parseJson(json) {
      const {
        constructor
      } = this;
      const {
        file,
        storage
      } = json;

      if (file && storage) {
        var _constructor$app$getS;

        (_constructor$app$getS = constructor.app.getStorage(storage)) == null ? void 0 : _constructor$app$getS.convertAssetFile(file);
      }

      return json;
    }

  }, _class.properties = {
    key: {
      type: 'string',
      required: true,
      unique: true,
      index: true
    },
    file: {
      type: 'object',
      properties: {
        key: {
          type: 'string',
          required: true
        },
        name: {
          type: 'string',
          required: true
        },
        type: {
          type: 'string',
          required: true
        },
        size: {
          type: 'integer',
          required: true
        },
        url: {
          type: 'string'
        },
        width: {
          type: 'integer'
        },
        height: {
          type: 'integer'
        }
      }
    },
    storage: {
      type: 'string',
      required: true
    },
    count: {
      type: 'integer',
      unsigned: true,
      default: 0
    }
  }, _temp;
});
exports.AssetMixin = AssetMixin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taXhpbnMvQXNzZXRNaXhpbi5qcyJdLCJuYW1lcyI6WyJBc3NldE1peGluIiwiTW9kZWwiLCIkcGFyc2VKc29uIiwianNvbiIsImNvbnN0cnVjdG9yIiwiZmlsZSIsInN0b3JhZ2UiLCJhcHAiLCJnZXRTdG9yYWdlIiwiY29udmVydEFzc2V0RmlsZSIsInByb3BlcnRpZXMiLCJrZXkiLCJ0eXBlIiwicmVxdWlyZWQiLCJ1bmlxdWUiLCJpbmRleCIsIm5hbWUiLCJzaXplIiwidXJsIiwid2lkdGgiLCJoZWlnaHQiLCJjb3VudCIsInVuc2lnbmVkIiwiZGVmYXVsdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7QUFDQTs7QUFHTyxNQUFNQSxVQUFVLEdBQUcsa0JBQU1DLEtBQUs7QUFBQTs7QUFBQSwwQkFBSSxjQUFjLHdDQUFpQkEsS0FBakIsQ0FBZCxDQUFzQztBQTZEN0VDLElBQUFBLFVBQVUsQ0FBQ0MsSUFBRCxFQUFPO0FBQ2YsWUFBTTtBQUFFQyxRQUFBQTtBQUFGLFVBQWtCLElBQXhCO0FBQ0EsWUFBTTtBQUFFQyxRQUFBQSxJQUFGO0FBQVFDLFFBQUFBO0FBQVIsVUFBb0JILElBQTFCOztBQUVBLFVBQUlFLElBQUksSUFBSUMsT0FBWixFQUFxQjtBQUFBOztBQUNuQixpQ0FBQUYsV0FBVyxDQUFDRyxHQUFaLENBQWdCQyxVQUFoQixDQUEyQkYsT0FBM0IsNENBQXFDRyxnQkFBckMsQ0FBc0RKLElBQXREO0FBQ0Q7O0FBQ0QsYUFBT0YsSUFBUDtBQUNEOztBQXJFNEUsR0FBMUMsU0FDNUJPLFVBRDRCLEdBQ2Y7QUFDbEJDLElBQUFBLEdBQUcsRUFBRTtBQUNIQyxNQUFBQSxJQUFJLEVBQUUsUUFESDtBQUVIQyxNQUFBQSxRQUFRLEVBQUUsSUFGUDtBQUdIQyxNQUFBQSxNQUFNLEVBQUUsSUFITDtBQUlIQyxNQUFBQSxLQUFLLEVBQUU7QUFKSixLQURhO0FBUWxCVixJQUFBQSxJQUFJLEVBQUU7QUFDSk8sTUFBQUEsSUFBSSxFQUFFLFFBREY7QUFJSkYsTUFBQUEsVUFBVSxFQUFFO0FBRVZDLFFBQUFBLEdBQUcsRUFBRTtBQUNIQyxVQUFBQSxJQUFJLEVBQUUsUUFESDtBQUVIQyxVQUFBQSxRQUFRLEVBQUU7QUFGUCxTQUZLO0FBT1ZHLFFBQUFBLElBQUksRUFBRTtBQUNKSixVQUFBQSxJQUFJLEVBQUUsUUFERjtBQUVKQyxVQUFBQSxRQUFRLEVBQUU7QUFGTixTQVBJO0FBWVZELFFBQUFBLElBQUksRUFBRTtBQUNKQSxVQUFBQSxJQUFJLEVBQUUsUUFERjtBQUVKQyxVQUFBQSxRQUFRLEVBQUU7QUFGTixTQVpJO0FBaUJWSSxRQUFBQSxJQUFJLEVBQUU7QUFDSkwsVUFBQUEsSUFBSSxFQUFFLFNBREY7QUFFSkMsVUFBQUEsUUFBUSxFQUFFO0FBRk4sU0FqQkk7QUFzQlZLLFFBQUFBLEdBQUcsRUFBRTtBQUNITixVQUFBQSxJQUFJLEVBQUU7QUFESCxTQXRCSztBQTBCVk8sUUFBQUEsS0FBSyxFQUFFO0FBQ0xQLFVBQUFBLElBQUksRUFBRTtBQURELFNBMUJHO0FBNkJWUSxRQUFBQSxNQUFNLEVBQUU7QUFDTlIsVUFBQUEsSUFBSSxFQUFFO0FBREE7QUE3QkU7QUFKUixLQVJZO0FBK0NsQk4sSUFBQUEsT0FBTyxFQUFFO0FBQ1BNLE1BQUFBLElBQUksRUFBRSxRQURDO0FBRVBDLE1BQUFBLFFBQVEsRUFBRTtBQUZILEtBL0NTO0FBb0RsQlEsSUFBQUEsS0FBSyxFQUFFO0FBQ0xULE1BQUFBLElBQUksRUFBRSxTQUREO0FBRUxVLE1BQUFBLFFBQVEsRUFBRSxJQUZMO0FBR0xDLE1BQUFBLE9BQU8sRUFBRTtBQUhKO0FBcERXLEdBRGU7QUFBQSxDQUFYLENBQW5CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWl4aW4gfSBmcm9tICdAZGl0b2pzL3V0aWxzJ1xuaW1wb3J0IHsgVGltZVN0YW1wZWRNaXhpbiB9IGZyb20gJy4vVGltZVN0YW1wZWRNaXhpbidcblxuLy8gQXNzZXQgbW9kZWxzIGFyZSBhbHdheXMgdG8gYmUgdGltZS1zdGFtcGVkOlxuZXhwb3J0IGNvbnN0IEFzc2V0TWl4aW4gPSBtaXhpbihNb2RlbCA9PiBjbGFzcyBleHRlbmRzIFRpbWVTdGFtcGVkTWl4aW4oTW9kZWwpIHtcbiAgc3RhdGljIHByb3BlcnRpZXMgPSB7XG4gICAga2V5OiB7XG4gICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgdW5pcXVlOiB0cnVlLFxuICAgICAgaW5kZXg6IHRydWVcbiAgICB9LFxuXG4gICAgZmlsZToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAvLyBUT0RPOiBTdXBwb3J0IHRoaXMgb24gJ29iamVjdCc6XG4gICAgICAvLyByZXF1aXJlZDogdHJ1ZVxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAvLyBUaGUgdW5pcXVlIGtleSB3aXRoaW4gdGhlIHN0b3JhZ2UgKHV1aWQvdjQgKyBmaWxlIGV4dGVuc2lvbilcbiAgICAgICAga2V5OiB7XG4gICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgLy8gVGhlIG9yaWdpbmFsIGZpbGVuYW1lLCBhbmQgZGlzcGxheSBuYW1lIHdoZW4gZmlsZSBpcyBzaG93blxuICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgLy8gVGhlIGZpbGUncyBtaW1lLXR5cGVcbiAgICAgICAgdHlwZToge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIC8vIFRoZSBhbW91bnQgb2YgYnl0ZXMgY29uc3VtZWQgYnkgdGhlIGZpbGVcbiAgICAgICAgc2l6ZToge1xuICAgICAgICAgIHR5cGU6ICdpbnRlZ2VyJyxcbiAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICAvLyBVc2UgZm9yIHN0b3JhZ2VzIGNvbmZpZ3VyZWQgZm9yIGZpbGVzIHRvIGJlIHB1YmxpY2FsbHkgYWNjZXNzaWJsZTpcbiAgICAgICAgdXJsOiB7XG4gICAgICAgICAgdHlwZTogJ3N0cmluZydcbiAgICAgICAgfSxcbiAgICAgICAgLy8gVGhlc2UgYXJlIG9ubHkgdXNlZCB3aGVuIHRoZSBzdG9yYWdlIGRlZmluZXMgYGNvbmZpZy5yZWFkSW1hZ2VTaXplYDpcbiAgICAgICAgd2lkdGg6IHtcbiAgICAgICAgICB0eXBlOiAnaW50ZWdlcidcbiAgICAgICAgfSxcbiAgICAgICAgaGVpZ2h0OiB7XG4gICAgICAgICAgdHlwZTogJ2ludGVnZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RvcmFnZToge1xuICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICByZXF1aXJlZDogdHJ1ZVxuICAgIH0sXG5cbiAgICBjb3VudDoge1xuICAgICAgdHlwZTogJ2ludGVnZXInLFxuICAgICAgdW5zaWduZWQ6IHRydWUsXG4gICAgICBkZWZhdWx0OiAwXG4gICAgfVxuICB9XG5cbiAgLy8gQG92ZXJyaWRlXG4gICRwYXJzZUpzb24oanNvbikge1xuICAgIGNvbnN0IHsgY29uc3RydWN0b3IgfSA9IHRoaXNcbiAgICBjb25zdCB7IGZpbGUsIHN0b3JhZ2UgfSA9IGpzb25cbiAgICAvLyBDb252ZXJ0IGBBc3NldE1peGluI2ZpbGVgIHRvIGFuIGBBc3NldEZpbGVgIGluc3RhbmNlOlxuICAgIGlmIChmaWxlICYmIHN0b3JhZ2UpIHtcbiAgICAgIGNvbnN0cnVjdG9yLmFwcC5nZXRTdG9yYWdlKHN0b3JhZ2UpPy5jb252ZXJ0QXNzZXRGaWxlKGZpbGUpXG4gICAgfVxuICAgIHJldHVybiBqc29uXG4gIH1cbn0pXG4iXX0=