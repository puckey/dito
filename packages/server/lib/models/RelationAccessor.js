"use strict";

exports.__esModule = true;
exports.default = void 0;

var _query = require("../query");

class RelationAccessor {
  constructor(relation, modelClass, model) {
    this.relation = relation;
    this.name = relation.name;
    this.modelClass = modelClass;
    this.model = model;
  }

  query(trx) {
    return this.modelClass ? this.modelClass.relatedQuery(this.name, trx) : this.model.$relatedQuery(this.name, trx);
  }

  load(arg0, ...args) {
    return this.modelClass ? this.modelClass.loadRelated(arg0, this.name, ...args) : this.model.$loadRelated(this.name, arg0, ...args);
  }

  get joinModelClass() {
    const {
      joinModelClass
    } = this.relation;

    if (joinModelClass && !('where' in joinModelClass)) {
      _query.QueryBuilder.mixin(joinModelClass);
    }

    return joinModelClass;
  }

}

exports.default = RelationAccessor;

_query.QueryBuilder.mixin(RelationAccessor.prototype);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbHMvUmVsYXRpb25BY2Nlc3Nvci5qcyJdLCJuYW1lcyI6WyJSZWxhdGlvbkFjY2Vzc29yIiwiY29uc3RydWN0b3IiLCJyZWxhdGlvbiIsIm1vZGVsQ2xhc3MiLCJtb2RlbCIsIm5hbWUiLCJxdWVyeSIsInRyeCIsInJlbGF0ZWRRdWVyeSIsIiRyZWxhdGVkUXVlcnkiLCJsb2FkIiwiYXJnMCIsImFyZ3MiLCJsb2FkUmVsYXRlZCIsIiRsb2FkUmVsYXRlZCIsImpvaW5Nb2RlbENsYXNzIiwiUXVlcnlCdWlsZGVyIiwibWl4aW4iLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7O0FBRWUsTUFBTUEsZ0JBQU4sQ0FBdUI7QUFDcENDLEVBQUFBLFdBQVcsQ0FBQ0MsUUFBRCxFQUFXQyxVQUFYLEVBQXVCQyxLQUF2QixFQUE4QjtBQUN2QyxTQUFLRixRQUFMLEdBQWdCQSxRQUFoQjtBQUNBLFNBQUtHLElBQUwsR0FBWUgsUUFBUSxDQUFDRyxJQUFyQjtBQUNBLFNBQUtGLFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0EsU0FBS0MsS0FBTCxHQUFhQSxLQUFiO0FBQ0Q7O0FBRURFLEVBQUFBLEtBQUssQ0FBQ0MsR0FBRCxFQUFNO0FBQ1QsV0FBTyxLQUFLSixVQUFMLEdBQ0gsS0FBS0EsVUFBTCxDQUFnQkssWUFBaEIsQ0FBNkIsS0FBS0gsSUFBbEMsRUFBd0NFLEdBQXhDLENBREcsR0FFSCxLQUFLSCxLQUFMLENBQVdLLGFBQVgsQ0FBeUIsS0FBS0osSUFBOUIsRUFBb0NFLEdBQXBDLENBRko7QUFHRDs7QUFFREcsRUFBQUEsSUFBSSxDQUFDQyxJQUFELEVBQU8sR0FBR0MsSUFBVixFQUFnQjtBQUNsQixXQUFPLEtBQUtULFVBQUwsR0FDSCxLQUFLQSxVQUFMLENBQWdCVSxXQUFoQixDQUE0QkYsSUFBNUIsRUFBa0MsS0FBS04sSUFBdkMsRUFBNkMsR0FBR08sSUFBaEQsQ0FERyxHQUVILEtBQUtSLEtBQUwsQ0FBV1UsWUFBWCxDQUF3QixLQUFLVCxJQUE3QixFQUFtQ00sSUFBbkMsRUFBeUMsR0FBR0MsSUFBNUMsQ0FGSjtBQUdEOztBQU9pQixNQUFkRyxjQUFjLEdBQUc7QUFDbkIsVUFBTTtBQUFFQSxNQUFBQTtBQUFGLFFBQXFCLEtBQUtiLFFBQWhDOztBQUlBLFFBQUlhLGNBQWMsSUFBSSxFQUFFLFdBQVdBLGNBQWIsQ0FBdEIsRUFBb0Q7QUFDbERDLDBCQUFhQyxLQUFiLENBQW1CRixjQUFuQjtBQUNEOztBQUNELFdBQU9BLGNBQVA7QUFDRDs7QUFsQ21DOzs7O0FBc0N0Q0Msb0JBQWFDLEtBQWIsQ0FBbUJqQixnQkFBZ0IsQ0FBQ2tCLFNBQXBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUXVlcnlCdWlsZGVyIH0gZnJvbSAnQC9xdWVyeSdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVsYXRpb25BY2Nlc3NvciB7XG4gIGNvbnN0cnVjdG9yKHJlbGF0aW9uLCBtb2RlbENsYXNzLCBtb2RlbCkge1xuICAgIHRoaXMucmVsYXRpb24gPSByZWxhdGlvblxuICAgIHRoaXMubmFtZSA9IHJlbGF0aW9uLm5hbWVcbiAgICB0aGlzLm1vZGVsQ2xhc3MgPSBtb2RlbENsYXNzXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsXG4gIH1cblxuICBxdWVyeSh0cngpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbENsYXNzXG4gICAgICA/IHRoaXMubW9kZWxDbGFzcy5yZWxhdGVkUXVlcnkodGhpcy5uYW1lLCB0cngpXG4gICAgICA6IHRoaXMubW9kZWwuJHJlbGF0ZWRRdWVyeSh0aGlzLm5hbWUsIHRyeClcbiAgfVxuXG4gIGxvYWQoYXJnMCwgLi4uYXJncykge1xuICAgIHJldHVybiB0aGlzLm1vZGVsQ2xhc3NcbiAgICAgID8gdGhpcy5tb2RlbENsYXNzLmxvYWRSZWxhdGVkKGFyZzAsIHRoaXMubmFtZSwgLi4uYXJncylcbiAgICAgIDogdGhpcy5tb2RlbC4kbG9hZFJlbGF0ZWQodGhpcy5uYW1lLCBhcmcwLCAuLi5hcmdzKVxuICB9XG5cbiAgLyoqXG4gICAqIEFjY2Vzc29yIHRvIHByb3ZpZGUgc2ltcGxpZmllZCBhY2Nlc3MgdG8gdGhlIGltcGxpY2l0bHkgZ2VuZXJhdGVkIGpvaW5cbiAgICogbW9kZWwgY2xhc3MsIGhhbmRsaW5nIHRoZSBwYXNzaW5nIG9uIG9mICB0aGUga25leCBpbnN0YW5jZSwgYXMgd2VsbCBhc1xuICAgKiB0aGUgYXBwbGljYXRpb24gb2YgYFF1ZXJ5QnVpbGRlci5taXhpbigpYC5cbiAgICovXG4gIGdldCBqb2luTW9kZWxDbGFzcygpIHtcbiAgICBjb25zdCB7IGpvaW5Nb2RlbENsYXNzIH0gPSB0aGlzLnJlbGF0aW9uXG4gICAgLy8gUmVzdWx0IGlzIGFscmVhZHkgY2FjaGVkIHBlciBrbmV4IGJ5IGB0aGlzLnJlbGF0aW9uLmpvaW5Nb2RlbENsYXNzKClgLFxuICAgIC8vIHNvIGFsbCB0aGF0J3MgbGVmdCB0byBkbyBpcyBhcHBseSBgUXVlcnlCdWlsZGVyLm1peGluKClgLFxuICAgIC8vIGlmIHRoZXJlIGlzIG5vIGBqb2luTW9kZWxDbGFzcy53aGVyZSgpYCB5ZXQ6XG4gICAgaWYgKGpvaW5Nb2RlbENsYXNzICYmICEoJ3doZXJlJyBpbiBqb2luTW9kZWxDbGFzcykpIHtcbiAgICAgIFF1ZXJ5QnVpbGRlci5taXhpbihqb2luTW9kZWxDbGFzcylcbiAgICB9XG4gICAgcmV0dXJuIGpvaW5Nb2RlbENsYXNzXG4gIH1cbn1cblxuLy8gRXhwb3NlIGEgc2VsZWN0aW9uIG9mIFF1ZXJ5QnVpbGRlciBtZXRob2RzIGFzIGluc3RhbmNlIG1ldGhvZHMgb24gcmVsYXRpb25zLlxuUXVlcnlCdWlsZGVyLm1peGluKFJlbGF0aW9uQWNjZXNzb3IucHJvdG90eXBlKVxuIl19