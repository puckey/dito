"use strict";

var _objection = require("objection");

var _models = require("../models");

var _relations = require("./relations");

describe('getRelationClass()', () => {
  it('returns the corresponding relation classes', () => {
    expect((0, _relations.getRelationClass)('belongs-to')).toBe(_objection.BelongsToOneRelation);
    expect((0, _relations.getRelationClass)('has-one')).toBe(_objection.HasOneRelation);
    expect((0, _relations.getRelationClass)('has-one-through')).toBe(_objection.HasOneThroughRelation);
    expect((0, _relations.getRelationClass)('has-many')).toBe(_objection.HasManyRelation);
    expect((0, _relations.getRelationClass)('many-to-many')).toBe(_objection.ManyToManyRelation);
    expect((0, _relations.getRelationClass)('belongsTo')).toBe(_objection.BelongsToOneRelation);
    expect((0, _relations.getRelationClass)('hasOne')).toBe(_objection.HasOneRelation);
    expect((0, _relations.getRelationClass)('hasOneThrough')).toBe(_objection.HasOneThroughRelation);
    expect((0, _relations.getRelationClass)('hasMany')).toBe(_objection.HasManyRelation);
    expect((0, _relations.getRelationClass)('manyToMany')).toBe(_objection.ManyToManyRelation);
    expect((0, _relations.getRelationClass)('BelongsToOneRelation')).toBe(_objection.BelongsToOneRelation);
    expect((0, _relations.getRelationClass)('HasOneRelation')).toBe(_objection.HasOneRelation);
    expect((0, _relations.getRelationClass)('HasOneThroughRelation')).toBe(_objection.HasOneThroughRelation);
    expect((0, _relations.getRelationClass)('HasManyRelation')).toBe(_objection.HasManyRelation);
    expect((0, _relations.getRelationClass)('ManyToManyRelation')).toBe(_objection.ManyToManyRelation);
  });
});
describe('convertRelation()', () => {
  class ModelOne extends _models.Model {}

  class ModelTwo extends _models.Model {}

  const models = {
    ModelOne,
    ModelTwo
  };
  it('converts a belongs-to relation to Objection.js format', () => {
    expect((0, _relations.convertRelation)({
      relation: 'belongs-to',
      from: 'ModelOne.modelTwoId',
      to: 'ModelTwo.id',
      modify: 'myScope'
    }, models)).toEqual({
      relation: _objection.BelongsToOneRelation,
      modelClass: ModelTwo,
      join: {
        from: 'ModelOne.modelTwoId',
        to: 'ModelTwo.id'
      },
      modify: 'myScope'
    });
  });
  it('converts a many-to-many relation to Objection.js format', () => {
    expect((0, _relations.convertRelation)({
      relation: 'many-to-many',
      from: 'ModelOne.id',
      to: 'ModelTwo.id',
      inverse: false
    }, models)).toEqual({
      relation: _objection.ManyToManyRelation,
      modelClass: ModelTwo,
      join: {
        from: 'ModelOne.id',
        through: {
          from: 'ModelOneModelTwo.modelOneId',
          to: 'ModelOneModelTwo.modelTwoId'
        },
        to: 'ModelTwo.id'
      }
    });
  });
  it('converts an inverse many-to-many relation to Objection.js format', () => {
    expect((0, _relations.convertRelation)({
      relation: 'many-to-many',
      from: 'ModelTwo.id',
      to: 'ModelOne.id',
      inverse: true
    }, models)).toEqual({
      relation: _objection.ManyToManyRelation,
      modelClass: ModelOne,
      join: {
        from: 'ModelTwo.id',
        through: {
          from: 'ModelOneModelTwo.modelTwoId',
          to: 'ModelOneModelTwo.modelOneId'
        },
        to: 'ModelOne.id'
      }
    });
  });
  it('preserves Objection.js relation format', () => {
    const relation = {
      relation: _objection.BelongsToOneRelation,
      modelClass: ModelTwo,
      join: {
        from: 'ModelOne.modelTwoId',
        to: 'ModelTwo.id'
      },
      modify: 'myScope'
    };
    expect((0, _relations.convertRelation)(relation, models)).toEqual(relation);
  });
});
describe('addRelationSchemas()', () => {
  class ModelOne extends _models.Model {}

  ModelOne.relations = {
    modelTwo: {
      relation: 'belongs-to',
      from: 'ModelOne.modelTwoId',
      to: 'ModelTwo.id'
    }
  };

  class ModelTwo extends _models.Model {}

  ModelTwo.relations = {
    modelOnes: {
      relation: 'has-many',
      from: 'ModelTwo.id',
      to: 'ModelOne.modelTwoId',
      owner: true
    }
  };
  ModelOne.app = ModelTwo.app = {
    models: {
      ModelOne,
      ModelTwo
    }
  };
  it('adds correct property schema for a belongs-to relation', () => {
    expect((0, _relations.addRelationSchemas)(ModelOne, {})).toEqual({
      modelTwo: {
        anyOf: [{
          type: 'null'
        }, {
          relate: 'ModelTwo'
        }, {
          $ref: 'ModelTwo'
        }]
      }
    });
  });
  it('adds correct property schema for a has-many owner relation', () => {
    expect((0, _relations.addRelationSchemas)(ModelTwo, {})).toEqual({
      modelOnes: {
        type: 'array',
        items: {
          $ref: 'ModelOne'
        }
      }
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY2hlbWEvcmVsYXRpb25zLnRlc3QuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJpdCIsImV4cGVjdCIsInRvQmUiLCJCZWxvbmdzVG9PbmVSZWxhdGlvbiIsIkhhc09uZVJlbGF0aW9uIiwiSGFzT25lVGhyb3VnaFJlbGF0aW9uIiwiSGFzTWFueVJlbGF0aW9uIiwiTWFueVRvTWFueVJlbGF0aW9uIiwiTW9kZWxPbmUiLCJNb2RlbCIsIk1vZGVsVHdvIiwibW9kZWxzIiwicmVsYXRpb24iLCJmcm9tIiwidG8iLCJtb2RpZnkiLCJ0b0VxdWFsIiwibW9kZWxDbGFzcyIsImpvaW4iLCJpbnZlcnNlIiwidGhyb3VnaCIsInJlbGF0aW9ucyIsIm1vZGVsVHdvIiwibW9kZWxPbmVzIiwib3duZXIiLCJhcHAiLCJhbnlPZiIsInR5cGUiLCJyZWxhdGUiLCIkcmVmIiwiaXRlbXMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBT0E7O0FBQ0E7O0FBSUFBLFFBQVEsQ0FBQyxvQkFBRCxFQUF1QixNQUFNO0FBQ25DQyxFQUFBQSxFQUFFLENBQUMsNENBQUQsRUFBK0MsTUFBTTtBQUNyREMsSUFBQUEsTUFBTSxDQUFDLGlDQUFpQixZQUFqQixDQUFELENBQU4sQ0FBdUNDLElBQXZDLENBQTRDQywrQkFBNUM7QUFDQUYsSUFBQUEsTUFBTSxDQUFDLGlDQUFpQixTQUFqQixDQUFELENBQU4sQ0FBb0NDLElBQXBDLENBQXlDRSx5QkFBekM7QUFDQUgsSUFBQUEsTUFBTSxDQUFDLGlDQUFpQixpQkFBakIsQ0FBRCxDQUFOLENBQTRDQyxJQUE1QyxDQUFpREcsZ0NBQWpEO0FBQ0FKLElBQUFBLE1BQU0sQ0FBQyxpQ0FBaUIsVUFBakIsQ0FBRCxDQUFOLENBQXFDQyxJQUFyQyxDQUEwQ0ksMEJBQTFDO0FBQ0FMLElBQUFBLE1BQU0sQ0FBQyxpQ0FBaUIsY0FBakIsQ0FBRCxDQUFOLENBQXlDQyxJQUF6QyxDQUE4Q0ssNkJBQTlDO0FBRUFOLElBQUFBLE1BQU0s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Q00sT0FBekMsQ0FBaUQ7QUFDL0NPLE1BQUFBLFNBQVMsRUFBRTtBQUNUSSxRQUFBQSxJQUFJLEVBQUUsT0FERztBQUVURyxRQUFBQSxLQUFLLEVBQUU7QUFBRUQsVUFBQUEsSUFBSSxFQUFFO0FBQVI7QUFGRTtBQURvQyxLQUFqRDtBQU1ELEdBUEMsQ0FBRjtBQVFELENBL0NPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCZWxvbmdzVG9PbmVSZWxhdGlvbixcbiAgSGFzT25lUmVsYXRpb24sXG4gIEhhc09uZVRocm91Z2hSZWxhdGlvbixcbiAgSGFzTWFueVJlbGF0aW9uLFxuICBNYW55VG9NYW55UmVsYXRpb25cbn0gZnJvbSAnb2JqZWN0aW9uJ1xuaW1wb3J0IHsgTW9kZWwgfSBmcm9tICdAL21vZGVscydcbmltcG9ydCB7XG4gIGdldFJlbGF0aW9uQ2xhc3MsIGNvbnZlcnRSZWxhdGlvbiwgYWRkUmVsYXRpb25TY2hlbWFzXG59IGZyb20gJy4vcmVsYXRpb25zJ1xuXG5kZXNjcmliZSgnZ2V0UmVsYXRpb25DbGFzcygpJywgKCkgPT4ge1xuICBpdCgncmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyByZWxhdGlvbiBjbGFzc2VzJywgKCkgPT4ge1xuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdiZWxvbmdzLXRvJykpLnRvQmUoQmVsb25nc1RvT25lUmVsYXRpb24pXG4gICAgZXhwZWN0KGdldFJlbGF0aW9uQ2xhc3MoJ2hhcy1vbmUnKSkudG9CZShIYXNPbmVSZWxhdGlvbilcbiAgICBleHBlY3QoZ2V0UmVsYXRpb25DbGFzcygnaGFzLW9uZS10aHJvdWdoJykpLnRvQmUoSGFzT25lVGhyb3VnaFJlbGF0aW9uKVxuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdoYXMtbWFueScpKS50b0JlKEhhc01hbnlSZWxhdGlvbilcbiAgICBleHBlY3QoZ2V0UmVsYXRpb25DbGFzcygnbWFueS10by1tYW55JykpLnRvQmUoTWFueVRvTWFueVJlbGF0aW9uKVxuXG4gICAgZXhwZWN0KGdldFJlbGF0aW9uQ2xhc3MoJ2JlbG9uZ3NUbycpKS50b0JlKEJlbG9uZ3NUb09uZVJlbGF0aW9uKVxuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdoYXNPbmUnKSkudG9CZShIYXNPbmVSZWxhdGlvbilcbiAgICBleHBlY3QoZ2V0UmVsYXRpb25DbGFzcygnaGFzT25lVGhyb3VnaCcpKS50b0JlKEhhc09uZVRocm91Z2hSZWxhdGlvbilcbiAgICBleHBlY3QoZ2V0UmVsYXRpb25DbGFzcygnaGFzTWFueScpKS50b0JlKEhhc01hbnlSZWxhdGlvbilcbiAgICBleHBlY3QoZ2V0UmVsYXRpb25DbGFzcygnbWFueVRvTWFueScpKS50b0JlKE1hbnlUb01hbnlSZWxhdGlvbilcblxuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdCZWxvbmdzVG9PbmVSZWxhdGlvbicpKS50b0JlKEJlbG9uZ3NUb09uZVJlbGF0aW9uKVxuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdIYXNPbmVSZWxhdGlvbicpKS50b0JlKEhhc09uZVJlbGF0aW9uKVxuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdIYXNPbmVUaHJvdWdoUmVsYXRpb24nKSlcbiAgICAgIC50b0JlKEhhc09uZVRocm91Z2hSZWxhdGlvbilcbiAgICBleHBlY3QoZ2V0UmVsYXRpb25DbGFzcygnSGFzTWFueVJlbGF0aW9uJykpLnRvQmUoSGFzTWFueVJlbGF0aW9uKVxuICAgIGV4cGVjdChnZXRSZWxhdGlvbkNsYXNzKCdNYW55VG9NYW55UmVsYXRpb24nKSkudG9CZShNYW55VG9NYW55UmVsYXRpb24pXG4gIH0pXG59KVxuXG5kZXNjcmliZSgnY29udmVydFJlbGF0aW9uKCknLCAoKSA9PiB7XG4gIGNsYXNzIE1vZGVsT25lIGV4dGVuZHMgTW9kZWwge31cbiAgY2xhc3MgTW9kZWxUd28gZXh0ZW5kcyBNb2RlbCB7fVxuXG4gIGNvbnN0IG1vZGVscyA9IHsgTW9kZWxPbmUsIE1vZGVsVHdvIH1cblxuICBpdCgnY29udmVydHMgYSBiZWxvbmdzLXRvIHJlbGF0aW9uIHRvIE9iamVjdGlvbi5qcyBmb3JtYXQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KGNvbnZlcnRSZWxhdGlvbih7XG4gICAgICByZWxhdGlvbjogJ2JlbG9uZ3MtdG8nLFxuICAgICAgZnJvbTogJ01vZGVsT25lLm1vZGVsVHdvSWQnLFxuICAgICAgdG86ICdNb2RlbFR3by5pZCcsXG4gICAgICBtb2RpZnk6ICdteVNjb3BlJ1xuICAgIH0sIG1vZGVscykpLnRvRXF1YWwoe1xuICAgICAgcmVsYXRpb246IEJlbG9uZ3NUb09uZVJlbGF0aW9uLFxuICAgICAgbW9kZWxDbGFzczogTW9kZWxUd28sXG4gICAgICBqb2luOiB7XG4gICAgICAgIGZyb206ICdNb2RlbE9uZS5tb2RlbFR3b0lkJyxcbiAgICAgICAgdG86ICdNb2RlbFR3by5pZCdcbiAgICAgIH0sXG4gICAgICBtb2RpZnk6ICdteVNjb3BlJ1xuICAgIH0pXG4gIH0pXG5cbiAgaXQoJ2NvbnZlcnRzIGEgbWFueS10by1tYW55IHJlbGF0aW9uIHRvIE9iamVjdGlvbi5qcyBmb3JtYXQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KGNvbnZlcnRSZWxhdGlvbih7XG4gICAgICByZWxhdGlvbjogJ21hbnktdG8tbWFueScsXG4gICAgICBmcm9tOiAnTW9kZWxPbmUuaWQnLFxuICAgICAgdG86ICdNb2RlbFR3by5pZCcsXG4gICAgICBpbnZlcnNlOiBmYWxzZVxuICAgIH0sIG1vZGVscykpLnRvRXF1YWwoe1xuICAgICAgcmVsYXRpb246IE1hbnlUb01hbnlSZWxhdGlvbixcbiAgICAgIG1vZGVsQ2xhc3M6IE1vZGVsVHdvLFxuICAgICAgam9pbjoge1xuICAgICAgICBmcm9tOiAnTW9kZWxPbmUuaWQnLFxuICAgICAgICB0aHJvdWdoOiB7XG4gICAgICAgICAgZnJvbTogJ01vZGVsT25lTW9kZWxUd28ubW9kZWxPbmVJZCcsXG4gICAgICAgICAgdG86ICdNb2RlbE9uZU1vZGVsVHdvLm1vZGVsVHdvSWQnXG4gICAgICAgIH0sXG4gICAgICAgIHRvOiAnTW9kZWxUd28uaWQnXG4gICAgICB9XG4gICAgfSlcbiAgfSlcblxuICBpdCgnY29udmVydHMgYW4gaW52ZXJzZSBtYW55LXRvLW1hbnkgcmVsYXRpb24gdG8gT2JqZWN0aW9uLmpzIGZvcm1hdCcsICgpID0+IHtcbiAgICBleHBlY3QoY29udmVydFJlbGF0aW9uKHtcbiAgICAgIHJlbGF0aW9uOiAnbWFueS10by1tYW55JyxcbiAgICAgIGZyb206ICdNb2RlbFR3by5pZCcsXG4gICAgICB0bzogJ01vZGVsT25lLmlkJyxcbiAgICAgIGludmVyc2U6IHRydWVcbiAgICB9LCBtb2RlbHMpKS50b0VxdWFsKHtcbiAgICAgIHJlbGF0aW9uOiBNYW55VG9NYW55UmVsYXRpb24sXG4gICAgICBtb2RlbENsYXNzOiBNb2RlbE9uZSxcbiAgICAgIGpvaW46IHtcbiAgICAgICAgZnJvbTogJ01vZGVsVHdvLmlkJyxcbiAgICAgICAgdGhyb3VnaDoge1xuICAgICAgICAgIGZyb206ICdNb2RlbE9uZU1vZGVsVHdvLm1vZGVsVHdvSWQnLFxuICAgICAgICAgIHRvOiAnTW9kZWxPbmVNb2RlbFR3by5tb2RlbE9uZUlkJ1xuICAgICAgICB9LFxuICAgICAgICB0bzogJ01vZGVsT25lLmlkJ1xuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgaXQoJ3ByZXNlcnZlcyBPYmplY3Rpb24uanMgcmVsYXRpb24gZm9ybWF0JywgKCkgPT4ge1xuICAgIGNvbnN0IHJlbGF0aW9uID0ge1xuICAgICAgcmVsYXRpb246IEJlbG9uZ3NUb09uZVJlbGF0aW9uLFxuICAgICAgbW9kZWxDbGFzczogTW9kZWxUd28sXG4gICAgICBqb2luOiB7XG4gICAgICAgIGZyb206ICdNb2RlbE9uZS5tb2RlbFR3b0lkJyxcbiAgICAgICAgdG86ICdNb2RlbFR3by5pZCdcbiAgICAgIH0sXG4gICAgICBtb2RpZnk6ICdteVNjb3BlJ1xuICAgIH1cbiAgICBleHBlY3QoY29udmVydFJlbGF0aW9uKHJlbGF0aW9uLCBtb2RlbHMpKS50b0VxdWFsKHJlbGF0aW9uKVxuICB9KVxufSlcblxuZGVzY3JpYmUoJ2FkZFJlbGF0aW9uU2NoZW1hcygpJywgKCkgPT4ge1xuICBjbGFzcyBNb2RlbE9uZSBleHRlbmRzIE1vZGVsIHtcbiAgICBzdGF0aWMgcmVsYXRpb25zID0ge1xuICAgICAgbW9kZWxUd286IHtcbiAgICAgICAgcmVsYXRpb246ICdiZWxvbmdzLXRvJyxcbiAgICAgICAgZnJvbTogJ01vZGVsT25lLm1vZGVsVHdvSWQnLFxuICAgICAgICB0bzogJ01vZGVsVHdvLmlkJ1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNsYXNzIE1vZGVsVHdvIGV4dGVuZHMgTW9kZWwge1xuICAgIHN0YXRpYyByZWxhdGlvbnMgPSB7XG4gICAgICBtb2RlbE9uZXM6IHtcbiAgICAgICAgcmVsYXRpb246ICdoYXMtbWFueScsXG4gICAgICAgIGZyb206ICdNb2RlbFR3by5pZCcsXG4gICAgICAgIHRvOiAnTW9kZWxPbmUubW9kZWxUd29JZCcsXG4gICAgICAgIG93bmVyOiB0cnVlXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gQWRkIGEgbW9jayBhcHAgdG8gYm90aCwgdG8gZXhwb3NlIG1vZGVsczpcbiAgTW9kZWxPbmUuYXBwID0gTW9kZWxUd28uYXBwID0ge1xuICAgIG1vZGVsczogeyBNb2RlbE9uZSwgTW9kZWxUd28gfVxuICB9XG5cbiAgaXQoJ2FkZHMgY29ycmVjdCBwcm9wZXJ0eSBzY2hlbWEgZm9yIGEgYmVsb25ncy10byByZWxhdGlvbicsICgpID0+IHtcbiAgICBleHBlY3QoYWRkUmVsYXRpb25TY2hlbWFzKE1vZGVsT25lLCB7fSkpLnRvRXF1YWwoe1xuICAgICAgbW9kZWxUd286IHtcbiAgICAgICAgYW55T2Y6IFtcbiAgICAgICAgICB7IHR5cGU6ICdudWxsJyB9LFxuICAgICAgICAgIHsgcmVsYXRlOiAnTW9kZWxUd28nIH0sXG4gICAgICAgICAgeyAkcmVmOiAnTW9kZWxUd28nIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgaXQoJ2FkZHMgY29ycmVjdCBwcm9wZXJ0eSBzY2hlbWEgZm9yIGEgaGFzLW1hbnkgb3duZXIgcmVsYXRpb24nLCAoKSA9PiB7XG4gICAgZXhwZWN0KGFkZFJlbGF0aW9uU2NoZW1hcyhNb2RlbFR3bywge30pKS50b0VxdWFsKHtcbiAgICAgIG1vZGVsT25lczoge1xuICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICBpdGVtczogeyAkcmVmOiAnTW9kZWxPbmUnIH1cbiAgICAgIH1cbiAgICB9KVxuICB9KVxufSlcbiJdfQ==