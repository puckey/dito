"use strict";

exports.__esModule = true;
exports.format = format;
exports.defaultFormats = void 0;

require("core-js/modules/es.object.entries.js");

require("core-js/modules/es.object.assign.js");

require("core-js/modules/es.array.join.js");

require("core-js/modules/es.array.map.js");

require("core-js/modules/es.array.includes.js");

var _base = require("../base");

var defaultFormats = {
  number: {
    style: 'decimal'
  },
  date: {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  },
  time: {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  }
};
exports.defaultFormats = defaultFormats;

function format(value, _temp) {
  var _ref = _temp === void 0 ? {} : _temp,
      _ref$locale = _ref.locale,
      locale = _ref$locale === void 0 ? 'en-US' : _ref$locale,
      number = _ref.number,
      date = _ref.date,
      time = _ref.time,
      _ref$defaults = _ref.defaults,
      defaults = _ref$defaults === void 0 ? defaultFormats : _ref$defaults;

  var formats = {
    number: number,
    date: date,
    time: time
  };
  var defaultValue = number || date || time ? undefined : true;

  var getOptions = function getOptions(name) {
    var _formats$name;

    var defaultOption = defaults[name];
    var option = (_formats$name = formats[name]) != null ? _formats$name : defaultValue;
    return option === true ? defaultOption : (0, _base.isObject)(option) ? Object.entries(Object.assign({}, defaultOption, option)).reduce(function (opt, _ref2) {
      var key = _ref2[0],
          value = _ref2[1];

      if (value !== false) {
        opt[key] = value;
      }

      return opt;
    }, {}) : {};
  };

  if (value != null) {
    if (number) {
      value = (0, _base.isNumber)(value) ? value : parseFloat(value);
    } else if (date || time) {
      value = (0, _base.isDate)(value) ? value : new Date(value);
    }
  }

  var options;

  if ((0, _base.isNumber)(value)) {
    if (number === false) {
      return '';
    } else {
      options = getOptions('number');

      if (options.format) {
        var parts = new Intl.NumberFormat(locale, options).formatToParts(value);
        return parts.map(function (_ref3) {
          var _options$format;

          var type = _ref3.type,
              value = _ref3.value;
          return (_options$format = options.format(value, type, options)) != null ? _options$format : value;
        }).join('');
      }
    }
  } else if ((0, _base.isDate)(value)) {
    if (date === false && time === false) {
      return '';
    } else {
      var opts = {
        date: getOptions('date'),
        time: getOptions('time')
      };
      options = Object.assign({}, opts.date, opts.time);

      if (options.format) {
        var _parts = new Intl.DateTimeFormat(locale, options).formatToParts(value);

        var modeOpts = null;
        return _parts.map(function (_ref4) {
          var _modeOpts$format, _modeOpts;

          var type = _ref4.type,
              value = _ref4.value;

          if (type !== 'literal') {
            var mode = ['weekday', 'day', 'month', 'year'].includes(type) ? 'date' : 'time';
            modeOpts = opts[mode];
          }

          return (_modeOpts$format = (_modeOpts = modeOpts) == null ? void 0 : _modeOpts.format == null ? void 0 : _modeOpts.format(value, type, modeOpts)) != null ? _modeOpts$format : value;
        }).join('');
      }
    }
  }

  return value != null ? value.toLocaleString(locale, options) : value;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdHJpbmcvZm9ybWF0LmpzIl0sIm5hbWVzIjpbImRlZmF1bHRGb3JtYXRzIiwibnVtYmVyIiwic3R5bGUiLCJkYXRlIiwiZGF5IiwibW9udGgiLCJ5ZWFyIiwidGltZSIsImhvdXIiLCJtaW51dGUiLCJzZWNvbmQiLCJmb3JtYXQiLCJ2YWx1ZSIsImxvY2FsZSIsImRlZmF1bHRzIiwiZm9ybWF0cyIsImRlZmF1bHRWYWx1ZSIsInVuZGVmaW5lZCIsImdldE9wdGlvbnMiLCJuYW1lIiwiZGVmYXVsdE9wdGlvbiIsIm9wdGlvbiIsIk9iamVjdCIsImVudHJpZXMiLCJyZWR1Y2UiLCJvcHQiLCJrZXkiLCJwYXJzZUZsb2F0IiwiRGF0ZSIsIm9wdGlvbnMiLCJwYXJ0cyIsIkludGwiLCJOdW1iZXJGb3JtYXQiLCJmb3JtYXRUb1BhcnRzIiwibWFwIiwidHlwZSIsImpvaW4iLCJvcHRzIiwiRGF0ZVRpbWVGb3JtYXQiLCJtb2RlT3B0cyIsIm1vZGUiLCJpbmNsdWRlcyIsInRvTG9jYWxlU3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRU8sSUFBTUEsY0FBYyxHQUFHO0FBQzVCQyxFQUFBQSxNQUFNLEVBQUU7QUFDTkMsSUFBQUEsS0FBSyxFQUFFO0FBREQsR0FEb0I7QUFJNUJDLEVBQUFBLElBQUksRUFBRTtBQUNKQyxJQUFBQSxHQUFHLEVBQUUsU0FERDtBQUVKQyxJQUFBQSxLQUFLLEVBQUUsTUFGSDtBQUdKQyxJQUFBQSxJQUFJLEVBQUU7QUFIRixHQUpzQjtBQVM1QkMsRUFBQUEsSUFBSSxFQUFFO0FBQ0pDLElBQUFBLElBQUksRUFBRSxTQURGO0FBRUpDLElBQUFBLE1BQU0sRUFBRSxTQUZKO0FBR0pDLElBQUFBLE1BQU0sRUFBRTtBQUhKO0FBVHNCLENBQXZCOzs7QUFnQkEsU0FBU0MsTUFBVCxDQUFnQkMsS0FBaEIsU0FNQztBQUFBLGdDQUFKLEVBQUk7QUFBQSx5QkFMTkMsTUFLTTtBQUFBLE1BTE5B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ZWN0IH0gZnJvbSAnQC9iYXNlJ1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdEZvcm1hdHMgPSB7XG4gIG51bWJlcjoge1xuICAgIHN0eWxlOiAnZGVjaW1hbCdcbiAgfSxcbiAgZGF0ZToge1xuICAgIGRheTogJ251bWVyaWMnLFxuICAgIG1vbnRoOiAnbG9uZycsXG4gICAgeWVhcjogJ251bWVyaWMnXG4gIH0sXG4gIHRpbWU6IHtcbiAgICBob3VyOiAnMi1kaWdpdCcsXG4gICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgc2Vjb25kOiAnMi1kaWdpdCdcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0KHZhbHVlLCB7XG4gIGxvY2FsZSA9ICdlbi1VUycsXG4gIG51bWJlcixcbiAgZGF0ZSxcbiAgdGltZSxcbiAgZGVmYXVsdHMgPSBkZWZhdWx0Rm9ybWF0c1xufSA9IHt9KSB7XG4gIGNvbnN0IGZvcm1hdHMgPSB7IG51bWJlciwgZGF0ZSwgdGltZSB9XG4gIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IG51bWJlciB8fCBkYXRlIHx8IHRpbWUgPyB1bmRlZmluZWQgOiB0cnVlXG4gIGNvbnN0IGdldE9wdGlvbnMgPSBuYW1lID0+IHtcbiAgICBjb25zdCBkZWZhdWx0T3B0aW9uID0gZGVmYXVsdHNbbmFtZV1cbiAgICBjb25zdCBvcHRpb24gPSBmb3JtYXRzW25hbWVdID8/IGRlZmF1bHRWYWx1ZVxuICAgIHJldHVybiBvcHRpb24gPT09IHRydWVcbiAgICAgID8gZGVmYXVsdE9wdGlvblxuICAgICAgOiBpc09iamVjdChvcHRpb24pXG4gICAgICAgID8gT2JqZWN0LmVudHJpZXMoe1xuICAgICAgICAgIC4uLmRlZmF1bHRPcHRpb24sXG4gICAgICAgICAgLi4ub3B0aW9uXG4gICAgICAgIH0pLnJlZHVjZSgob3B0LCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICBpZiAodmFsdWUgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBvcHRba2V5XSA9IHZhbHVlXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvcHRcbiAgICAgICAgfSwge30pXG4gICAgICAgIDoge31cbiAgfVxuXG4gIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgaWYgKG51bWJlcikge1xuICAgICAgdmFsdWUgPSBpc051bWJlcih2YWx1ZSkgPyB2YWx1ZSA6IHBhcnNlRmxvYXQodmFsdWUpXG4gICAgfSBlbHNlIGlmIChkYXRlIHx8IHRpbWUpIHtcbiAgICAgIHZhbHVlID0gaXNEYXRlKHZhbHVlKSA/IHZhbHVlIDogbmV3IERhdGUodmFsdWUpXG4gICAgfVxuICB9XG5cbiAgbGV0IG9wdGlvbnNcbiAgaWYgKGlzTnVtYmVyKHZhbHVlKSkge1xuICAgIGlmIChudW1iZXIgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gJydcbiAgICB9IGVsc2Uge1xuICAgICAgb3B0aW9ucyA9IGdldE9wdGlvbnMoJ251bWJlcicpXG4gICAgICBpZiAob3B0aW9ucy5mb3JtYXQpIHtcbiAgICAgICAgLy8gU3VwcG9ydCBjdXN0b20gcG9zdC1mb3JtYXR0aW5nIG9mIG51bWJlciBmb3JtYXRzLFxuICAgICAgICAvLyBlLmcuIHRvIHJlcGxhY2UgZGVjaW1hbHMgYW5kIHN1Y2g6XG4gICAgICAgIGNvbnN0IHBhcnRzID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSwgb3B0aW9ucylcbiAgICAgICAgICAuZm9ybWF0VG9QYXJ0cyh2YWx1ZSlcbiAgICAgICAgcmV0dXJuIHBhcnRzLm1hcCgoeyB0eXBlLCB2YWx1ZSB9KSA9PlxuICAgICAgICAgIG9wdGlvbnMuZm9ybWF0KHZhbHVlLCB0eXBlLCBvcHRpb25zKSA/PyB2YWx1ZVxuICAgICAgICApLmpvaW4oJycpXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKGlzRGF0ZSh2YWx1ZSkpIHtcbiAgICBpZiAoZGF0ZSA9PT0gZmFsc2UgJiYgdGltZSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiAnJ1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGbGF0dGVuIHRoZSBzZXBhcmF0ZSBkYXRlIC8gdGltZSBvcHRpb25zIGRvd24gdG8gb25lXG4gICAgICBjb25zdCBvcHRzID0ge1xuICAgICAgICBkYXRlOiBnZXRPcHRpb25zKCdkYXRlJyksXG4gICAgICAgIHRpbWU6IGdldE9wdGlvbnMoJ3RpbWUnKVxuICAgICAgfVxuICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgLi4ub3B0cy5kYXRlLFxuICAgICAgICAuLi5vcHRzLnRpbWVcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmZvcm1hdCkge1xuICAgICAgICAvLyBTdXBwb3J0IGN1c3RvbSBwb3N0LWZvcm1hdHRpbmcgb2YgYm90aCB0aW1lIGFuZCBkYXRlIGZvcm1hdHMsXG4gICAgICAgIC8vIGUuZy4gdG8gcmVwbGFjZSBzZXBhcmF0b3JzIGFuZCBzdWNoOlxuICAgICAgICBjb25zdCBwYXJ0cyA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgb3B0aW9ucylcbiAgICAgICAgICAuZm9ybWF0VG9QYXJ0cyh2YWx1ZSlcbiAgICAgICAgbGV0IG1vZGVPcHRzID0gbnVsbFxuICAgICAgICByZXR1cm4gcGFydHMubWFwKCh7IHR5cGUsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICBpZiAodHlwZSAhPT0gJ2xpdGVyYWwnKSB7XG4gICAgICAgICAgICAvLyBTd2l0Y2ggbW9kZSBiZXR3ZWVuIGRhdGUgJiB0aW1lIHRvIHBpY2sgdGhlIHJpZ2h0IGZvcm1hdCBtZXRoZG9kOlxuICAgICAgICAgICAgY29uc3QgbW9kZSA9IFsnd2Vla2RheScsICdkYXknLCAnbW9udGgnLCAneWVhciddLmluY2x1ZGVzKHR5cGUpXG4gICAgICAgICAgICAgID8gJ2RhdGUnXG4gICAgICAgICAgICAgIDogJ3RpbWUnXG4gICAgICAgICAgICBtb2RlT3B0cyA9IG9wdHNbbW9kZV1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG1vZGVPcHRzPy5mb3JtYXQ/Lih2YWx1ZSwgdHlwZSwgbW9kZU9wdHMpID8/IHZhbHVlXG4gICAgICAgIH0pLmpvaW4oJycpXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB2YWx1ZSAhPSBudWxsXG4gICAgPyB2YWx1ZS50b0xvY2FsZVN0cmluZyhsb2NhbGUsIG9wdGlvbnMpXG4gICAgOiB2YWx1ZVxufVxuIl19